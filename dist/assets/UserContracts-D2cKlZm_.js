import{j as $,d as Te,r as i,l as Be,g as Q,o as Le,C as ze,V as _e,a as d,c as g,b as a,e as s,w as r,F as je,u as R,h as E,k as v,t as D,X as me,s as Re,z as W,Y as Pe,a9 as ve,aa as Fe}from"./index-tGn4A1jT.js";import{s as Me}from"./index-CBPX7evQ.js";import{s as Oe,a as He}from"./index-CbfkePsN.js";import{c as be,b as Ke,a as Xe}from"./index-Bwkcf4_4.js";import{a as Ye,s as Ge}from"./index-CW9BEc_m.js";import{a as Je,s as Qe}from"./index-DLoWA6ri.js";import{s as We}from"./index-CpwlYGpO.js";import{s as Ze}from"./index-Drds92g8.js";import{s as ea}from"./index-DbULOkeh.js";import{s as aa}from"./index-Dwxam53z.js";import{s as ta}from"./index-Bw3PGiQj.js";import{U as fe}from"./UserService-DX-dhTzX.js";import{S as la}from"./ServiceService-CNM5YgeI.js";import"./index-CQudeSsu.js";import"./index-C86jlxDl.js";import"./index-uE_RgOwy.js";import"./index-C5xJpaZd.js";import"./index-CoebC6Ed.js";import"./index-uqkg05Wy.js";import"./PhotoService-D-6329la.js";var oa={name:"Dropdown",extends:be,mounted:function(){console.warn("Deprecated since v4. Use Select component instead.")}};const U="/contract",I={async getContractsByInfluencerId(u){return(await $.get(`${U}/influencer/${u}`)).data},async getContractsByBusinessId(u){return(await $.get(`${U}/business/${u}`)).data},async getContractById(u){return(await $.get(`${U}/${u}`)).data},async createContract(u){return(await $.post(`${U}`,u)).data},async updateContract(u,f){return(await $.put(`${U}/${u}`,f)).data},async deleteContract(u){return(await $.delete(`${U}/${u}`)).data}},sa={class:"card"},na={class:"flex flex-col md:flex-row justify-between gap-4"},ia={class:"flex flex-wrap md:justify-start gap-2"},ra={class:"flex items-center gap-2"},da={class:"flex justify-center items-center rounded-full overflow-hidden"},ca={class:"flex space-x-2"},ua={class:"p-4"},pa={class:"mb-4"},ma={key:0,class:"flex flex-col gap-4"},va={class:"text-gray-700"},fa={class:"text-gray-700"},ba={class:"text-gray-700"},ya={class:"text-gray-700"},ga={key:1},Ca={class:"flex flex-col gap-6"},xa={key:0,class:"text-red-500"},ka={key:0,class:"text-red-500"},Da={key:0,class:"text-red-500"},Sa={key:0,class:"text-red-500"},wa={key:0,class:"text-red-500"},Ia={key:0,class:"text-red-500"},qa={key:0,class:"text-red-500"},Va={class:"flex items-center gap-2"},$a={class:"flex items-center gap-2"},Ga=Te({__name:"UserContracts",setup(u){const f=i({global:{value:null,matchMode:Pe.CONTAINS}}),Z=i(["All","Pending"]),P=i("All"),c=i(!1),o=i({}),B=i(!1),A=i(!1),h=i(!1),N=i(!1),m=i(null),x=i(!1),C=Be(),L=i([]),ee=i(!1),F=i(!1),q=i(!1),M=Number(localStorage.getItem("userId")??0),ae=i(),T=String(localStorage.getItem("typeOfUser")??"Undefined"),z=i([]),te=i(),le=i([]),O=i();Q(O,t=>{o.value.type=t==null?void 0:t.display});const H=i([]),K=i(null);Q(K,t=>{o.value.services=t?[t]:[];const e=Ce();te.value=e??0,o.value.price=te.value});const oe=i([]),_=i(null);Q(_,async t=>{if(ae.value=_.value.id,t){o.value.influencerId=t.id;try{const e=await la.getServicesByUserId(t.id);H.value=e.filter(n=>n.state==="active").map(n=>({id:n.id,name:n.name,status:n.state,price:n.price}))}catch(e){console.error("Error fetching services:",e),C.add({severity:"error",summary:"Error",detail:"Could not load services",life:3e3})}}else H.value=[]}),Le(async()=>{le.value=await ze.getCategories(),oe.value=(await fe.getUserByType("Influencer")).map(t=>({display:`${t.firstName} ${t.lastName}`,id:t.id})),await se()});function ye(){o.value={},c.value=!1,B.value=!0}function X(){o.value={},c.value=!1,B.value=!1}const b={titleError:i(""),descriptionError:i(""),typeError:i(""),influencerError:i(""),servicesError:i(""),startDateError:i(""),finalDateError:i("")};function k(t,e,n){Array.isArray(t)?t.some(y=>y==null||typeof y=="string"&&y.trim()===""||typeof y=="number"&&isNaN(y)||y instanceof Date&&isNaN(y.getTime()))?n.value=e:n.value="":t==null||typeof t=="string"&&t.trim()===""||typeof t=="number"&&isNaN(t)||t instanceof Date&&isNaN(t.getTime())?n.value=e:n.value=""}async function ge(){if(c.value=!0,k(o.value.title,"El nombre de contrato es obligatorio",b.titleError),k(o.value.description,"La descripción es obligatoria",b.descriptionError),k(o.value.type,"La categoría es obligatorio",b.typeError),k(o.value.influencerId,"El influencer es obligatorio",b.typeError),k(o.value.services,"El servicio es obligatorio",b.typeError),k(o.value.startDate,"La fecha de inicio es obligatoria",b.startDateError),k(o.value.finalDate,"La fecha de fin es obligatoria",b.finalDateError),k(o.value.type,"La categoría es obligatorio",b.typeError),Object.values(b).some(e=>e.value)){console.log(b);return}o.value.influencerId=ae.value||0,o.value.businessId=M,o.value.status="pending";const t=i({});t.value.businessId=o.value.businessId,t.value.influencerId=o.value.influencerId,console.log("datos pa guardar: ",o.value);try{if(A.value=!0,o.value.id)await I.updateContract(o.value.id,o.value),C.add({severity:"success",summary:"Success",detail:"Contract Updated",life:3e3});else{const e=await I.createContract(o.value),n=await ve.postSmartContract(t.value);e.hash=n.transactionHash,await I.updateContract(e.id,e),C.add({severity:"success",summary:"Success",detail:"Contract Created",life:3e3})}X(),await se()}catch(e){C.add({severity:"error",summary:"Error",detail:e.message,life:3e3})}finally{A.value=!1}}async function se(){F.value=!1,ee.value=!0;try{const t=T==="Influencer"?await I.getContractsByInfluencerId(M):await I.getContractsByBusinessId(M);z.value=await Promise.all(t.map(async e=>{const n=T==="Influencer"?e.businessId:e.influencerId,w=await fe.getUserById(n);return n===e.businessId?{...e,name:w.user_name,photo:w.photo}:{...e,name:w.firstName,photo:w.photo}})),F.value=!0}catch{C.add({severity:"error",summary:"Error",detail:"Error fetching contracts",life:3e3})}finally{ee.value=!1}}function Ce(){return o.value.services&&o.value.services.length>0?o.value.services.reduce((e,n)=>e+(n.price||0),0):0}const xe=_e(()=>P.value==="Pending"?z.value.filter(t=>t.status==="pending"):z.value);function ke(t){m.value=t,h.value=!0}function De(t){m.value=t,N.value=!0}function Se(){m.value&&(m.value.status="active",I.updateContract(m.value.id,m.value).then(()=>{var t;C.add({severity:"success",summary:"Status Updated",detail:`Contract status updated to ${(t=m.value)==null?void 0:t.status}`,life:3e3})}).catch(t=>{C.add({severity:"error",summary:"Error",detail:`Error updating status: ${t.message}`,life:3e3})}).finally(()=>{h.value=!1}))}function we(){m.value&&(m.value.status="cancel",I.updateContract(m.value.id,m.value).then(()=>{C.add({severity:"success",summary:"Contract Cancelled",detail:"Contract status updated to cancel",life:3e3})}).catch(t=>{C.add({severity:"error",summary:"Error",detail:`Error cancelling contract: ${t.message}`,life:3e3})}).finally(()=>{N.value=!1}))}function ne(){h.value=!1,N.value=!1}function Ie(){L.value=z.value.map(t=>t.id)}function qe(){L.value=[]}function ie(t){return t==null||isNaN(t)?"$0.00":t.toLocaleString("en-US",{style:"currency",currency:"USD"})}const re=t=>{switch(t){case"active":return{severity:"success",label:"Active"};case"pending":return{severity:"warn",label:"Pending"};case"cancel":return{severity:"danger",label:"Cancel"};default:return{severity:"secondary",label:"Undefined"}}},S=i(null),Y=i(!1),Ve=async(t,e)=>{try{console.log(e),Y.value=!0;const n=await ve.getSmartContractData(e);n&&(S.value={...n,hash:t}),console.log(S)}catch(n){console.error("Error fetching SmartContract data:",n)}};return(t,e)=>{const n=ta,w=aa,y=Ke,G=ea,$e=Xe,p=Ge,Ee=Ze,Ue=We,Ae=Je,he=Qe,de=Ye,j=Oe,Ne=be,ce=oa,ue=He,pe=Me,J=Fe;return d(),g(je,null,[a("div",sa,[e[19]||(e[19]=a("div",{class:"font-semibold text-xl mb-4"},"Contracts List",-1)),s(de,{expandedRows:L.value,"onUpdate:expandedRows":e[2]||(e[2]=l=>L.value=l),value:xe.value,dataKey:"id",removableSort:"",filters:f.value,tableStyle:"min-width: 60rem",stripedRows:"",paginator:"",rows:10,rowsPerPageOptions:[10,20,50]},{header:r(()=>[a("div",na,[R(T)==="Business"?(d(),E(n,{key:0,label:"New",icon:"pi pi-plus",class:"mr-2",onClick:ye})):v("",!0),s(w,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=l=>P.value=l),options:Z.value,class:"mr-2"},null,8,["modelValue","options"]),s($e,null,{default:r(()=>[s(y,null,{default:r(()=>e[16]||(e[16]=[a("i",{class:"pi pi-search"},null,-1)])),_:1}),s(G,{modelValue:f.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value.global.value=l),placeholder:"Search..."},null,8,["modelValue"])]),_:1}),a("div",ia,[s(n,{text:"",icon:"pi pi-plus",label:"Expand All",onClick:Ie}),s(n,{text:"",icon:"pi pi-minus",label:"Collapse All",onClick:qe})])])]),expansion:r(l=>[a("div",ua,[e[17]||(e[17]=a("h5",{class:"font-bold text-l mb-2"},"Contract description:",-1)),a("p",pa,D(l.data.description),1),e[18]||(e[18]=a("h5",{class:"font-bold text-l mb-2"},"Services included:",-1)),s(de,{value:l.data.services,removableSort:""},{default:r(()=>[s(p,{field:"name",header:"Name",sortable:""}),s(p,{field:"description",header:"Description",sortable:""}),s(p,{field:"price",header:"Price",sortable:""},{body:r(V=>[me(D(ie(V.data.price)),1)]),_:2},1024),s(p,{field:"stars",header:"Rating",sortable:"",style:{"min-width":"12rem"}},{body:r(V=>[s(he,{modelValue:V.data.stars,readonly:!0},null,8,["modelValue"])]),_:2},1024)]),_:2},1032,["value"])])]),default:r(()=>[s(p,{expander:"",style:{width:"2rem"}}),s(p,{field:"title",header:"Title",sortable:""}),s(p,{header:R(T)==="Influencer"?"Business":"Influencer",field:"name",sortable:""},{body:r(({data:l})=>[a("div",ra,[a("div",da,[F.value?(d(),E(Ee,{key:0,alt:l.name,src:`${R(Re)}`+l.photo,style:{width:"32px",height:"32px"},class:"object-cover"},null,8,["alt","src"])):(d(),E(Ue,{key:1,shape:"circle",size:"32"}))]),a("span",null,D(l.name),1)])]),_:1},8,["header"]),s(p,{field:"price",header:"Price",sortable:""},{body:r(l=>[me(D(ie(l.data.price)),1)]),_:1}),s(p,{field:"startDate",header:"Start Date",sortable:""}),s(p,{field:"finalDate",header:"Final Date",sortable:""}),s(p,{field:"type",header:"Type",sortable:""}),s(p,{field:"status",header:"Status",sortable:""},{body:r(l=>[s(Ae,{value:re(l.data.status).label,severity:re(l.data.status).severity},null,8,["value","severity"])]),_:1}),R(T)=="Influencer"?(d(),E(p,{key:0,header:"Actions"},{body:r(({data:l})=>[a("div",ca,[W(s(n,{icon:"pi pi-file",severity:"info",rounded:"",variant:"outlined","aria-label":"User",onClick:V=>Ve(l.hash,l.id)},null,8,["onClick"]),[[J,"Contract information",void 0,{bottom:!0}]]),l.status=="pending"?W((d(),E(n,{key:0,icon:"pi pi-check",rounded:"",variant:"outlined","aria-label":"Accept",severity:"success",onClick:V=>ke(l)},null,8,["onClick"])),[[J,"Accept contract",void 0,{bottom:!0}]]):v("",!0),l.status=="pending"?W((d(),E(n,{key:1,icon:"pi pi-times",rounded:"",variant:"outlined","aria-label":"Reject",severity:"danger",onClick:V=>De(l)},null,8,["onClick"])),[[J,"Reject contract",void 0,{bottom:!0}]]):v("",!0)])]),_:1})):v("",!0)]),_:1},8,["expandedRows","value","filters"])]),s(j,{visible:Y.value,"onUpdate:visible":e[3]||(e[3]=l=>Y.value=l),style:{width:"500px"},header:"📄 Contract Details",modal:"",draggable:!1,class:"p-fluid"},{footer:r(()=>[s(n,{label:"Cancel",icon:"pi pi-times",text:"",onClick:X})]),default:r(()=>[S.value?(d(),g("div",ma,[a("div",null,[e[20]||(e[20]=a("label",{class:"block font-bold mb-2"},"Contract ID:",-1)),a("span",va,D(S.value.contractId),1)]),a("div",null,[e[21]||(e[21]=a("label",{class:"block font-bold mb-2"},"Influencer ID:",-1)),a("span",fa,D(S.value.influencerId),1)]),a("div",null,[e[22]||(e[22]=a("label",{class:"block font-bold mb-2"},"Business ID:",-1)),a("span",ba,D(S.value.businessId),1)]),a("div",null,[e[23]||(e[23]=a("label",{class:"block font-bold mb-2"},"Hash Contract:",-1)),a("span",ya,D(S.value.hash),1)])])):(d(),g("div",ga,e[24]||(e[24]=[a("p",null,"No contract data available.",-1)])))]),_:1},8,["visible"]),s(j,{visible:B.value,"onUpdate:visible":e[11]||(e[11]=l=>B.value=l),style:{width:"450px"},header:"Contract Details",modal:"",draggable:!1},{footer:r(()=>[s(n,{label:"Cancel",icon:"pi pi-times",text:"",onClick:X}),s(n,{icon:"pi pi-check",label:A.value?"Registering...":"Register",loading:A.value,disabled:A.value,onClick:ge},null,8,["label","loading","disabled"])]),default:r(()=>[a("div",Ca,[a("div",null,[e[25]||(e[25]=a("label",{for:"title",class:"block font-bold mb-3"},"Title",-1)),s(G,{id:"title",modelValue:o.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.title=l),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:c.value&&!o.value.title,fluid:""},null,8,["modelValue","invalid"]),c.value&&!o.value.title?(d(),g("small",xa,"Title is required.")):v("",!0)]),a("div",null,[e[26]||(e[26]=a("label",{for:"description",class:"block font-bold mb-3"},"Description",-1)),s(G,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.description=l),modelModifiers:{trim:!0},required:"true",invalid:c.value&&!o.value.description,fluid:""},null,8,["modelValue","invalid"]),c.value&&!o.value.description?(d(),g("small",ka,"Description is required.")):v("",!0)]),a("div",null,[e[27]||(e[27]=a("label",{for:"type",class:"block font-bold mb-3"},"Type",-1)),s(Ne,{modelValue:O.value,"onUpdate:modelValue":e[6]||(e[6]=l=>O.value=l),modelModifiers:{trim:!0},options:le.value,optionLabel:"display",placeholder:"Select a Type",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),c.value&&!o.value.type?(d(),g("small",Da,"Type is required.")):v("",!0)]),a("div",null,[e[28]||(e[28]=a("label",{for:"influencerId",class:"block font-bold mb-3"},"Influencer",-1)),s(ce,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),options:oe.value,filter:"",optionLabel:"display",placeholder:"Select an Influencer",class:"w-full"},null,8,["modelValue","options"]),c.value&&!o.value.influencerId?(d(),g("small",Sa," Influencer is required. ")):v("",!0)]),a("div",null,[e[29]||(e[29]=a("label",{for:"services",class:"block font-bold mb-3"},"Service",-1)),s(ce,{modelValue:K.value,"onUpdate:modelValue":e[8]||(e[8]=l=>K.value=l),options:H.value,filter:"",optionLabel:"name",placeholder:"Select an Service",class:"w-full"},null,8,["modelValue","options"]),c.value&&!o.value.services?(d(),g("small",wa," Service is required. ")):v("",!0)]),a("div",null,[e[30]||(e[30]=a("label",{for:"startDate",class:"block font-bold mb-3"},"Start Date",-1)),s(ue,{id:"startDate",modelValue:o.value.startDate,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.startDate=l),required:"true",invalid:c.value&&!o.value.startDate,showIcon:"",fluid:"",iconDisplay:"input"},null,8,["modelValue","invalid"]),c.value&&!o.value.startDate?(d(),g("small",Ia,"Start Date is required.")):v("",!0)]),a("div",null,[e[31]||(e[31]=a("label",{for:"finalDate",class:"block font-bold mb-3"},"Final Date",-1)),s(ue,{id:"finalDate",modelValue:o.value.finalDate,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.finalDate=l),required:"true",invalid:c.value&&!o.value.finalDate,showIcon:"",fluid:"",iconDisplay:"input"},null,8,["modelValue","invalid"]),c.value&&!o.value.finalDate?(d(),g("small",qa,"Final Date is required.")):v("",!0)])])]),_:1},8,["visible"]),s(j,{visible:h.value,"onUpdate:visible":e[13]||(e[13]=l=>h.value=l),header:"Confirm Acceptance of Contract",modal:"",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,draggable:!1},{footer:r(()=>[s(n,{label:"Cancel",icon:"pi pi-times",onClick:ne}),s(n,{icon:"pi pi-check",label:q.value?"Updating...":"Confirm",loading:q.value,disabled:q.value||!x.value,onClick:Se},null,8,["label","loading","disabled"])]),default:r(()=>[e[33]||(e[33]=a("p",{class:"mb-8"}," Antes de aceptar este contrato, le solicitamos que lea atentamente todos los términos y condiciones establecidos en el mismo. Al aceptar el contrato, usted está confirmando que comprende completamente los servicios y tareas que se le asignarán, los cuales están detalladamente especificados en el documento. Asegúrese de estar conforme con las responsabilidades y expectativas que conlleva el contrato, ya que cualquier incumplimiento podría generar consecuencias. ",-1)),e[34]||(e[34]=a("p",{class:"mb-2 font-bold text-xl"},"Responsabilidad de Cancelación",-1)),e[35]||(e[35]=a("p",{class:"mb-8"}," SmartContracts no se hace responsable por la cancelación de este contrato. En caso de que desee cancelar o modificar los términos acordados, es fundamental que se comunique directamente con la empresa solicitante. Ambas partes deberán llegar a un acuerdo mutuo sobre la cancelación, de acuerdo con lo estipulado en el contrato. ",-1)),e[36]||(e[36]=a("p",{class:"mb-2 font-bold text-xl"},"Compromiso y Confidencialidad",-1)),e[37]||(e[37]=a("p",{class:"mb-8"}," Es importante destacar que este contrato puede implicar la divulgación de información sensible o exclusiva. Por lo tanto, se espera que mantenga la confidencialidad respecto a cualquier información relacionada con la empresa contratante y el alcance de los servicios que se le soliciten. Cualquier incumplimiento en este aspecto podría generar penalizaciones o la terminación del contrato de manera anticipada. ",-1)),e[38]||(e[38]=a("p",{class:"mb-2 font-bold text-xl"},"Condiciones Adicionales",-1)),e[39]||(e[39]=a("p",{class:"mb-4"}," Además, le recordamos que la naturaleza de los contratos SmartContracts implica una ejecución automática de los términos una vez que ambas partes han dado su consentimiento. De esta manera, SmartContracts actúa como un facilitador para que el acuerdo sea validado de forma segura y transparente. ",-1)),e[40]||(e[40]=a("p",{class:"mb-8"}," Le recomendamos que, en caso de tener dudas sobre algún aspecto del contrato, consulte con un abogado o experto legal antes de proceder con la aceptación. Al aceptar el contrato, usted está comprometido con los términos aquí expuestos y será responsable de cumplir con todas las obligaciones acordadas. ",-1)),e[41]||(e[41]=a("p",{class:"mb-2 font-bold text-xl"}," Asegúrese de leer todo el contrato cuidadosamente antes de aceptar. ",-1)),e[42]||(e[42]=a("p",{class:"mb-8"}," Si está de acuerdo con los términos y condiciones detallados, puede proceder con la aceptación. ",-1)),a("div",Va,[s(pe,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),invalid:!x.value,binary:""},null,8,["modelValue","invalid"]),e[32]||(e[32]=a("label",{for:"size_normal",class:"size_normal"},"Acepto los términos y condiciones del contrato.",-1))])]),_:1},8,["visible"]),s(j,{visible:N.value,"onUpdate:visible":e[15]||(e[15]=l=>N.value=l),header:"Confirm Acceptance of Contract",modal:"",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,draggable:!1},{footer:r(()=>[s(n,{label:"Cancel",icon:"pi pi-times",onClick:ne}),s(n,{icon:"pi pi-check",label:q.value?"Updating...":"Reject Contract",loading:q.value,disabled:q.value||!x.value,onClick:we},null,8,["label","loading","disabled"])]),default:r(()=>[e[44]||(e[44]=a("p",{class:"mb-4"}," Al proceder con el rechazo de este contrato, usted reconoce que esta acción es irreversible. Una vez que el contrato sea rechazado, no podrá ser restaurado ni modificado. ",-1)),e[45]||(e[45]=a("p",{class:"mb-4"}," Smart Contracts no se hace responsable de los costos ni consecuencias derivados de esta decisión, incluyendo pero no limitado a tarifas de transacción, costos operativos o cualquier otra implicación financiera o legal que pueda surgir como resultado del rechazo del contrato. ",-1)),e[46]||(e[46]=a("p",{class:"mb-4"}," Le recomendamos que revise cuidadosamente todos los términos y condiciones del contrato antes de tomar esta decisión. Si tiene alguna duda, por favor, consulte con un asesor legal o de confianza antes de proceder. ",-1)),e[47]||(e[47]=a("p",{class:"mb-4"}," Al continuar con el rechazo, usted acepta que Smart Contracts no asume ninguna responsabilidad por cualquier daño o perjuicio que pueda resultar de esta acción. ",-1)),a("div",$a,[s(pe,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=l=>x.value=l),invalid:!x.value,binary:""},null,8,["modelValue","invalid"]),e[43]||(e[43]=a("label",{for:"size_normal",class:"size_normal"},"Acepto los términos y condiciones del contrato.",-1))])]),_:1},8,["visible"])],64)}}});export{Ga as default};
