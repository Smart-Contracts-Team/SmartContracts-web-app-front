import{s as Ie}from"./index-BM3sGApC.js";import{s as ke,a as Ve}from"./index-B55SJdq0.js";import{c as ie,b as Ee,a as $e}from"./index-SMkO-0Uk.js";import{a as qe,s as Ue}from"./index-DSKr3QB9.js";import{a as Ne,s as Ae}from"./index-CtF5e5-U.js";import{s as Te}from"./index-D2WTH_3Y.js";import{s as he}from"./index-BeosiNou.js";import{s as Be}from"./index-BVoeFwAM.js";import{s as Le}from"./index-BQ82LSVU.js";import{h as D,d as _e,r as n,j as Pe,S as K,o as Fe,C as Oe,V as Re,a as p,c as y,b as s,e as o,w as i,F as ze,u as B,g as L,i as b,t as _,X as ne,s as Me,Y as je}from"./index-o2anLdNF.js";import{U as re}from"./UserService-CUGCGzV2.js";import{S as Ke}from"./ServiceService-CXl9STlF.js";import"./index-aKao5A2Z.js";import"./index-DJyijS95.js";import"./index-mbz8WqPB.js";import"./index-CrJWY7mn.js";import"./index-BtL0hmx1.js";import"./PhotoService-Cjq5erfy.js";var Xe={name:"Dropdown",extends:ie,mounted:function(){console.warn("Deprecated since v4. Use Select component instead.")}};const w="/contract",$={async getContractsByInfluencerId(u){return(await D.get(`${w}/influencer/${u}`)).data},async getContractsByBusinessId(u){return(await D.get(`${w}/business/${u}`)).data},async getContractById(u){return(await D.get(`${w}/${u}`)).data},async createContract(u){return(await D.post(`${w}`,u)).data},async updateContract(u,m){return(await D.put(`${w}/${u}`,m)).data},async deleteContract(u){return(await D.delete(`${w}/${u}`)).data}},Ye={class:"card"},Ge={class:"flex flex-col md:flex-row justify-between gap-4"},He={class:"flex flex-wrap md:justify-start gap-2"},Je={class:"flex items-center gap-2"},Qe=["alt","src"],We={class:"p-4"},Ze={class:"mb-4"},ea={class:"flex flex-col gap-6"},aa={key:0,class:"text-red-500"},ta={key:0,class:"text-red-500"},la={key:0,class:"text-red-500"},sa={key:0,class:"text-red-500"},oa={key:0,class:"text-red-500"},na={key:0,class:"text-red-500"},ra={key:0,class:"text-red-500"},ia={class:"flex items-center gap-2"},Ea=_e({__name:"UserContracts",setup(u){const m=n({global:{value:null,matchMode:je.CONTAINS}}),X=n(["All","Pending"]),P=n("All"),d=n(!1),t=n({}),q=n(!1),I=n(!1),k=n(!1),S=n(null),U=n(!1),g=Pe(),N=n([]),Y=n(!1),F=n(!1),V=n(!1),O=Number(localStorage.getItem("userId")??0),G=n(),E=String(localStorage.getItem("typeOfUser")??"Undefined"),A=n([]),H=n(),J=n([]),R=n();K(R,a=>{t.value.type=a==null?void 0:a.display});const z=n([]),M=n(null);K(M,a=>{t.value.services=a?[a]:[];const e=ce();H.value=e??0,t.value.price=H.value});const Q=n([]),T=n(null);K(T,async a=>{if(G.value=T.value.id,a){t.value.influencerId=a.id;try{const e=await Ke.getServicesByUserId(a.id);z.value=e.filter(r=>r.state==="active").map(r=>({id:r.id,name:r.name,status:r.state,price:r.price}))}catch(e){console.error("Error fetching services:",e),g.add({severity:"error",summary:"Error",detail:"Could not load services",life:3e3})}}else z.value=[]}),Fe(async()=>{J.value=await Oe.getCategories(),Q.value=(await re.getUserByType("Influencer")).map(a=>({display:`${a.firstName} ${a.lastName}`,id:a.id})),await Z()});function de(){t.value={},d.value=!1,q.value=!0}function W(){t.value={},d.value=!1,q.value=!1}const v={titleError:n(""),descriptionError:n(""),typeError:n(""),influencerError:n(""),servicesError:n(""),startDateError:n(""),finalDateError:n("")};function C(a,e,r){Array.isArray(a)?a.some(f=>f==null||typeof f=="string"&&f.trim()===""||typeof f=="number"&&isNaN(f)||f instanceof Date&&isNaN(f.getTime()))?r.value=e:r.value="":a==null||typeof a=="string"&&a.trim()===""||typeof a=="number"&&isNaN(a)||a instanceof Date&&isNaN(a.getTime())?r.value=e:r.value=""}async function ue(){if(d.value=!0,C(t.value.title,"El nombre de contrato es obligatorio",v.titleError),C(t.value.description,"La descripción es obligatoria",v.descriptionError),C(t.value.type,"La categoría es obligatorio",v.typeError),C(t.value.influencerId,"El influencer es obligatorio",v.typeError),C(t.value.services,"El servicio es obligatorio",v.typeError),C(t.value.startDate,"La fecha de inicio es obligatoria",v.startDateError),C(t.value.finalDate,"La fecha de fin es obligatoria",v.finalDateError),C(t.value.type,"La categoría es obligatorio",v.typeError),Object.values(v).some(a=>a.value)){console.log(v);return}t.value.influencerId=G.value||0,t.value.businessId=O,t.value.status="pending",console.log("datos pa guardar: ",t.value);try{I.value=!0,t.value.id?(await $.updateContract(t.value.id,t.value),g.add({severity:"success",summary:"Success",detail:"Contract Updated",life:3e3})):(await $.createContract(t.value),g.add({severity:"success",summary:"Success",detail:"Contract Created",life:3e3})),W(),await Z()}catch(a){g.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{I.value=!1}}async function Z(){F.value=!1,Y.value=!0;try{const a=E==="Influencer"?await $.getContractsByInfluencerId(O):await $.getContractsByBusinessId(O);A.value=await Promise.all(a.map(async e=>{const r=E==="Influencer"?e.businessId:e.influencerId,x=await re.getUserById(r);return r===e.businessId?{...e,name:x.user_name,photo:x.photo}:{...e,name:x.firstName,photo:x.photo}})),F.value=!0}catch{g.add({severity:"error",summary:"Error",detail:"Error fetching contracts",life:3e3})}finally{Y.value=!1}}function ce(){return t.value.services&&t.value.services.length>0?t.value.services.reduce((e,r)=>e+(r.price||0),0):0}const pe=Re(()=>P.value==="Pending"?A.value.filter(a=>a.status==="pending"):A.value);function me(a){a.status==="pending"?(S.value=a,k.value=!0):g.add({severity:"warn",summary:"Cannot Edit Status",detail:"Only pending contracts can be updated.",life:3e3})}function ve(){S.value&&(V.value=!0,S.value.status="active",$.updateContract(S.value.id,S.value).then(()=>{var a;g.add({severity:"success",summary:"Status Updated",detail:`Contract status updated to ${(a=S.value)==null?void 0:a.status}`,life:3e3})}).catch(a=>{g.add({severity:"error",summary:"Error",detail:`Error updating status: ${a.message}`,life:3e3})}).finally(()=>{k.value=!1,V.value=!1}))}function fe(){k.value=!1}function be(){N.value=A.value.map(a=>a.id)}function ye(){N.value=[]}function ee(a){return a==null||isNaN(a)?"$0.00":a.toLocaleString("en-US",{style:"currency",currency:"USD"})}const ae=a=>{switch(a){case"active":return{severity:"success",label:"Active"};case"pending":return{severity:"warn",label:"Pending"};case"cancel":return{severity:"danger",label:"Cancel"};default:return{severity:"secondary",label:"Undefined"}}};return(a,e)=>{const r=Le,x=Be,f=Ee,j=he,ge=$e,c=Ue,Ce=Te,xe=Ne,Se=Ae,te=qe,De=ie,le=Xe,se=Ve,oe=ke,we=Ie;return p(),y(ze,null,[s("div",Ye,[e[16]||(e[16]=s("div",{class:"font-semibold text-xl mb-4"},"Contracts List",-1)),o(te,{expandedRows:N.value,"onUpdate:expandedRows":e[2]||(e[2]=l=>N.value=l),value:pe.value,dataKey:"id",removableSort:"",filters:m.value,tableStyle:"min-width: 60rem",stripedRows:"",paginator:"",rows:10,rowsPerPageOptions:[10,20,50]},{header:i(()=>[s("div",Ge,[B(E)==="Business"?(p(),L(r,{key:0,label:"New",icon:"pi pi-plus",class:"mr-2",onClick:de})):b("",!0),o(x,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=l=>P.value=l),options:X.value,class:"mr-2"},null,8,["modelValue","options"]),o(ge,null,{default:i(()=>[o(f,null,{default:i(()=>e[13]||(e[13]=[s("i",{class:"pi pi-search"},null,-1)])),_:1}),o(j,{modelValue:m.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.global.value=l),placeholder:"Search..."},null,8,["modelValue"])]),_:1}),s("div",He,[o(r,{text:"",icon:"pi pi-plus",label:"Expand All",onClick:be}),o(r,{text:"",icon:"pi pi-minus",label:"Collapse All",onClick:ye})])])]),expansion:i(l=>[s("div",We,[e[14]||(e[14]=s("h5",{class:"font-bold text-l mb-2"},"Contract description:",-1)),s("p",Ze,_(l.data.description),1),e[15]||(e[15]=s("h5",{class:"font-bold text-l mb-2"},"Services included:",-1)),o(te,{value:l.data.services,removableSort:""},{default:i(()=>[o(c,{field:"name",header:"Name",sortable:""}),o(c,{field:"description",header:"Description",sortable:""}),o(c,{field:"price",header:"Price",sortable:""},{body:i(h=>[ne(_(ee(h.data.price)),1)]),_:2},1024),o(c,{field:"stars",header:"Rating",sortable:"",style:{"min-width":"12rem"}},{body:i(h=>[o(Se,{modelValue:h.data.stars,readonly:!0},null,8,["modelValue"])]),_:2},1024)]),_:2},1032,["value"])])]),default:i(()=>[o(c,{expander:"",style:{width:"2rem"}}),o(c,{field:"title",header:"Title",sortable:""}),o(c,{header:B(E)==="Influencer"?"Business":"Influencer",field:"name",sortable:""},{body:i(({data:l})=>[s("div",Je,[F.value?(p(),y("img",{key:0,alt:l.name,src:`${B(Me)}`+l.photo,style:{width:"32px",height:"32px"}},null,8,Qe)):(p(),L(Ce,{key:1,shape:"circle",size:"32"})),s("span",null,_(l.name),1)])]),_:1},8,["header"]),o(c,{field:"price",header:"Price",sortable:""},{body:i(l=>[ne(_(ee(l.data.price)),1)]),_:1}),o(c,{field:"startDate",header:"Start Date",sortable:""}),o(c,{field:"finalDate",header:"Final Date",sortable:""}),o(c,{field:"type",header:"Type",sortable:""}),o(c,{field:"status",header:"Status",sortable:""},{body:i(l=>[o(xe,{value:ae(l.data.status).label,severity:ae(l.data.status).severity},null,8,["value","severity"])]),_:1}),B(E)=="Influencer"?(p(),L(c,{key:0,header:"Actions"},{body:i(({data:l})=>[l.status=="pending"?(p(),L(r,{key:0,label:"Accept",class:"p-button-primary",onClick:h=>me(l)},null,8,["onClick"])):b("",!0)]),_:1})):b("",!0)]),_:1},8,["expandedRows","value","filters"])]),o(oe,{visible:q.value,"onUpdate:visible":e[10]||(e[10]=l=>q.value=l),style:{width:"450px"},header:"Contract Details",modal:"",draggable:!1},{footer:i(()=>[o(r,{label:"Cancel",icon:"pi pi-times",text:"",onClick:W}),o(r,{icon:"pi pi-check",label:I.value?"Registering...":"Register",loading:I.value,disabled:I.value,onClick:ue},null,8,["label","loading","disabled"])]),default:i(()=>[s("div",ea,[s("div",null,[e[17]||(e[17]=s("label",{for:"title",class:"block font-bold mb-3"},"Title",-1)),o(j,{id:"title",modelValue:t.value.title,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.title=l),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:d.value&&!t.value.title,fluid:""},null,8,["modelValue","invalid"]),d.value&&!t.value.title?(p(),y("small",aa,"Title is required.")):b("",!0)]),s("div",null,[e[18]||(e[18]=s("label",{for:"description",class:"block font-bold mb-3"},"Description",-1)),o(j,{id:"description",modelValue:t.value.description,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.description=l),modelModifiers:{trim:!0},required:"true",invalid:d.value&&!t.value.description,fluid:""},null,8,["modelValue","invalid"]),d.value&&!t.value.description?(p(),y("small",ta,"Description is required.")):b("",!0)]),s("div",null,[e[19]||(e[19]=s("label",{for:"type",class:"block font-bold mb-3"},"Type",-1)),o(De,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=l=>R.value=l),modelModifiers:{trim:!0},options:J.value,optionLabel:"display",placeholder:"Select a Type",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),d.value&&!t.value.type?(p(),y("small",la,"Type is required.")):b("",!0)]),s("div",null,[e[20]||(e[20]=s("label",{for:"influencerId",class:"block font-bold mb-3"},"Influencer",-1)),o(le,{modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=l=>T.value=l),options:Q.value,filter:"",optionLabel:"display",placeholder:"Select an Influencer",class:"w-full"},null,8,["modelValue","options"]),d.value&&!t.value.influencerId?(p(),y("small",sa," Influencer is required. ")):b("",!0)]),s("div",null,[e[21]||(e[21]=s("label",{for:"services",class:"block font-bold mb-3"},"Service",-1)),o(le,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=l=>M.value=l),options:z.value,filter:"",optionLabel:"name",placeholder:"Select an Service",class:"w-full"},null,8,["modelValue","options"]),d.value&&!t.value.services?(p(),y("small",oa," Service is required. ")):b("",!0)]),s("div",null,[e[22]||(e[22]=s("label",{for:"startDate",class:"block font-bold mb-3"},"Start Date",-1)),o(se,{id:"startDate",modelValue:t.value.startDate,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.startDate=l),required:"true",invalid:d.value&&!t.value.startDate,showIcon:"",fluid:"",iconDisplay:"input"},null,8,["modelValue","invalid"]),d.value&&!t.value.startDate?(p(),y("small",na,"Start Date is required.")):b("",!0)]),s("div",null,[e[23]||(e[23]=s("label",{for:"finalDate",class:"block font-bold mb-3"},"Final Date",-1)),o(se,{id:"finalDate",modelValue:t.value.finalDate,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.finalDate=l),required:"true",invalid:d.value&&!t.value.finalDate,showIcon:"",fluid:"",iconDisplay:"input"},null,8,["modelValue","invalid"]),d.value&&!t.value.finalDate?(p(),y("small",ra,"Final Date is required.")):b("",!0)])])]),_:1},8,["visible"]),o(oe,{visible:k.value,"onUpdate:visible":e[12]||(e[12]=l=>k.value=l),header:"Confirm Acceptance of Contract",modal:"",style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,draggable:!1},{footer:i(()=>[o(r,{label:"Cancel",icon:"pi pi-times",onClick:fe}),o(r,{icon:"pi pi-check",label:V.value?"Updating...":"Confirm",loading:V.value,disabled:V.value||!U.value,onClick:ve},null,8,["label","loading","disabled"])]),default:i(()=>[e[25]||(e[25]=s("p",{class:"mb-8"}," Antes de aceptar este contrato, le solicitamos que lea atentamente todos los términos y condiciones establecidos en el mismo. Al aceptar el contrato, usted está confirmando que comprende completamente los servicios y tareas que se le asignarán, los cuales están detalladamente especificados en el documento. Asegúrese de estar conforme con las responsabilidades y expectativas que conlleva el contrato, ya que cualquier incumplimiento podría generar consecuencias. ",-1)),e[26]||(e[26]=s("p",{class:"mb-2 font-bold text-xl"},"Responsabilidad de Cancelación",-1)),e[27]||(e[27]=s("p",{class:"mb-8"}," SmartContracts no se hace responsable por la cancelación de este contrato. En caso de que desee cancelar o modificar los términos acordados, es fundamental que se comunique directamente con la empresa solicitante. Ambas partes deberán llegar a un acuerdo mutuo sobre la cancelación, de acuerdo con lo estipulado en el contrato. ",-1)),e[28]||(e[28]=s("p",{class:"mb-2 font-bold text-xl"},"Compromiso y Confidencialidad",-1)),e[29]||(e[29]=s("p",{class:"mb-8"}," Es importante destacar que este contrato puede implicar la divulgación de información sensible o exclusiva. Por lo tanto, se espera que mantenga la confidencialidad respecto a cualquier información relacionada con la empresa contratante y el alcance de los servicios que se le soliciten. Cualquier incumplimiento en este aspecto podría generar penalizaciones o la terminación del contrato de manera anticipada. ",-1)),e[30]||(e[30]=s("p",{class:"mb-2 font-bold text-xl"},"Condiciones Adicionales",-1)),e[31]||(e[31]=s("p",{class:"mb-8"}," Además, le recordamos que la naturaleza de los contratos SmartContracts implica una ejecución automática de los términos una vez que ambas partes han dado su consentimiento. De esta manera, SmartContracts actúa como un facilitador para que el acuerdo sea validado de forma segura y transparente. ",-1)),e[32]||(e[32]=s("p",{class:"mb-8"}," Le recomendamos que, en caso de tener dudas sobre algún aspecto del contrato, consulte con un abogado o experto legal antes de proceder con la aceptación. Al aceptar el contrato, usted está comprometido con los términos aquí expuestos y será responsable de cumplir con todas las obligaciones acordadas. ",-1)),e[33]||(e[33]=s("p",{class:"mb-2 font-bold text-xl"}," Asegúrese de leer todo el contrato cuidadosamente antes de aceptar. ",-1)),e[34]||(e[34]=s("p",{class:"mb-8"}," Si está de acuerdo con los términos y condiciones detallados, puede proceder con la aceptación. ",-1)),s("div",ia,[o(we,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=l=>U.value=l),invalid:!U.value,binary:""},null,8,["modelValue","invalid"]),e[24]||(e[24]=s("label",{for:"size_normal",class:"size_normal"},"Acepto los términos y condiciones del contrato.",-1))])]),_:1},8,["visible"])],64)}}});export{Ea as default};
